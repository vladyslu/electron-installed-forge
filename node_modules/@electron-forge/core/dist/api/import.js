"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = void 0;
var _path = _interopRequireDefault(require("path"));
var _coreUtils = require("@electron-forge/core-utils");
var _templateBase = _interopRequireDefault(require("@electron-forge/template-base"));
var _chalk = _interopRequireDefault(require("chalk"));
var _debug = _interopRequireDefault(require("debug"));
var _fsExtra = _interopRequireDefault(require("fs-extra"));
var _listr2 = require("listr2");
var _lodash = require("lodash");
var _installDependencies = _interopRequireWildcard(require("../util/install-dependencies"));
var _readPackageJson = require("../util/read-package-json");
var _upgradeForgeConfig = _interopRequireWildcard(require("../util/upgrade-forge-config"));
var _initGit = require("./init-scripts/init-git");
var _initNpm = require("./init-scripts/init-npm");
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
        return obj;
    } else {
        var newObj = {};
        if (obj != null) {
            for(var key in obj){
                if (Object.prototype.hasOwnProperty.call(obj, key)) {
                    var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};
                    if (desc.get || desc.set) {
                        Object.defineProperty(newObj, key, desc);
                    } else {
                        newObj[key] = obj[key];
                    }
                }
            }
        }
        newObj.default = obj;
        return newObj;
    }
}
const d = (0, _debug).default('electron-forge:import');
var _default = async ({ dir =process.cwd() , interactive =false , confirmImport , shouldContinueOnExisting , shouldRemoveDependency , shouldUpdateScript , outDir  })=>{
    const listrOptions = {
        concurrent: false,
        rendererOptions: {
            collapse: false,
            collapseErrors: false
        },
        rendererSilent: !interactive,
        rendererFallback: Boolean(process.env.DEBUG && process.env.DEBUG.includes('electron-forge'))
    };
    const runner = new _listr2.Listr([
        {
            title: 'Locating importable project',
            task: async ()=>{
                d(`Attempting to import project in: ${dir}`);
                if (!await _fsExtra.default.pathExists(dir) || !await _fsExtra.default.pathExists(_path.default.resolve(dir, 'package.json'))) {
                    throw new Error(`We couldn't find a project with a package.json file in: ${dir}`);
                }
                if (typeof confirmImport === 'function') {
                    if (!await confirmImport()) {
                        // TODO: figure out if we can just return early here
                        // eslint-disable-next-line no-process-exit
                        process.exit(0);
                    }
                }
                await (0, _initGit).initGit(dir);
            }
        },
        {
            title: 'Processing configuration and dependencies',
            options: {
                persistentOutput: true,
                bottomBar: Infinity
            },
            task: async (ctx, task1)=>{
                const calculatedOutDir = outDir || 'out';
                const importDeps = [].concat(_initNpm.deps);
                let importDevDeps = [].concat(_initNpm.devDeps);
                let importExactDevDeps = [].concat(_initNpm.exactDevDeps);
                let packageJSON = await (0, _readPackageJson).readRawPackageJson(dir);
                if (!packageJSON.version) {
                    task1.output = _chalk.default.yellow(`Please set the ${_chalk.default.green('"version"')} in your application's package.json`);
                }
                if (packageJSON.config && packageJSON.config.forge) {
                    if (packageJSON.config.forge.makers) {
                        task1.output = _chalk.default.green('Existing Electron Forge configuration detected');
                        if (typeof shouldContinueOnExisting === 'function') {
                            if (!await shouldContinueOnExisting()) {
                                // TODO: figure out if we can just return early here
                                // eslint-disable-next-line no-process-exit
                                process.exit(0);
                            }
                        }
                    } else if (!(typeof packageJSON.config.forge === 'object')) {
                        task1.output = _chalk.default.yellow("We can't tell if the Electron Forge config is compatible because it's in an external JavaScript file, not trying to convert it and continuing anyway");
                    } else {
                        d('Upgrading an Electron Forge < 6 project');
                        packageJSON.config.forge = (0, _upgradeForgeConfig).default(packageJSON.config.forge);
                        importDevDeps = (0, _upgradeForgeConfig).updateUpgradedForgeDevDeps(packageJSON, importDevDeps);
                    }
                }
                packageJSON.dependencies = packageJSON.dependencies || {};
                packageJSON.devDependencies = packageJSON.devDependencies || {};
                [importDevDeps, importExactDevDeps] = (0, _coreUtils).updateElectronDependency(packageJSON, importDevDeps, importExactDevDeps);
                const keys = Object.keys(packageJSON.dependencies).concat(Object.keys(packageJSON.devDependencies));
                const buildToolPackages = {
                    '@electron/get': 'already uses this module as a transitive dependency',
                    '@electron/osx-sign': 'already uses this module as a transitive dependency',
                    'electron-builder': 'provides mostly equivalent functionality',
                    'electron-download': 'already uses this module as a transitive dependency',
                    'electron-forge': 'replaced with @electron-forge/cli',
                    'electron-installer-debian': 'already uses this module as a transitive dependency',
                    'electron-installer-dmg': 'already uses this module as a transitive dependency',
                    'electron-installer-flatpak': 'already uses this module as a transitive dependency',
                    'electron-installer-redhat': 'already uses this module as a transitive dependency',
                    'electron-packager': 'already uses this module as a transitive dependency',
                    'electron-winstaller': 'already uses this module as a transitive dependency'
                };
                for (const key of keys){
                    if (buildToolPackages[key]) {
                        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion
                        const explanation = buildToolPackages[key];
                        let remove = true;
                        if (typeof shouldRemoveDependency === 'function') {
                            remove = await shouldRemoveDependency(key, explanation);
                        }
                        if (remove) {
                            delete packageJSON.dependencies[key];
                            delete packageJSON.devDependencies[key];
                        }
                    }
                }
                packageJSON.scripts = packageJSON.scripts || {};
                d('reading current scripts object:', packageJSON.scripts);
                const updatePackageScript = async (scriptName, newValue)=>{
                    if (packageJSON.scripts[scriptName] !== newValue) {
                        let update = true;
                        if (typeof shouldUpdateScript === 'function') {
                            update = await shouldUpdateScript(scriptName, newValue);
                        }
                        if (update) {
                            packageJSON.scripts[scriptName] = newValue;
                        }
                    }
                };
                await updatePackageScript('start', 'electron-forge start');
                await updatePackageScript('package', 'electron-forge package');
                await updatePackageScript('make', 'electron-forge make');
                d('forgified scripts object:', packageJSON.scripts);
                const writeChanges = async ()=>{
                    await _fsExtra.default.writeJson(_path.default.resolve(dir, 'package.json'), packageJSON, {
                        spaces: 2
                    });
                };
                return task1.newListr([
                    {
                        title: 'Installing dependencies',
                        task: async (_, task)=>{
                            const packageManager = (0, _coreUtils).safeYarnOrNpm();
                            await writeChanges();
                            d('deleting old dependencies forcefully');
                            await _fsExtra.default.remove(_path.default.resolve(dir, 'node_modules/.bin/electron'));
                            await _fsExtra.default.remove(_path.default.resolve(dir, 'node_modules/.bin/electron.cmd'));
                            d('installing dependencies');
                            task.output = `${packageManager} install ${importDeps.join(' ')}`;
                            await (0, _installDependencies).default(dir, importDeps);
                            d('installing devDependencies');
                            task.output = `${packageManager} install --dev ${importDevDeps.join(' ')}`;
                            await (0, _installDependencies).default(dir, importDevDeps, _installDependencies.DepType.DEV);
                            d('installing exactDevDependencies');
                            task.output = `${packageManager} install --dev --exact ${importExactDevDeps.join(' ')}`;
                            await (0, _installDependencies).default(dir, importExactDevDeps, _installDependencies.DepType.DEV, _installDependencies.DepVersionRestriction.EXACT);
                        }
                    },
                    {
                        title: 'Copying base template Forge configuration',
                        task: async ()=>{
                            var ref;
                            const pathToTemplateConfig = _path.default.resolve(_templateBase.default.templateDir, 'forge.config.js');
                            // if there's an existing config.forge object in package.json
                            if ((packageJSON === null || packageJSON === void 0 ? void 0 : (ref = packageJSON.config) === null || ref === void 0 ? void 0 : ref.forge) && typeof packageJSON.config.forge === 'object') {
                                d('detected existing Forge config in package.json, merging with base template Forge config');
                                // eslint-disable-next-line @typescript-eslint/no-var-requires
                                const templateConfig = require(_path.default.resolve(_templateBase.default.templateDir, 'forge.config.js'));
                                packageJSON = await (0, _readPackageJson).readRawPackageJson(dir);
                                (0, _lodash).merge(templateConfig, packageJSON.config.forge); // mutates the templateConfig object
                                await writeChanges();
                            // otherwise, write to forge.config.js
                            } else {
                                d('writing new forge.config.js');
                                await _fsExtra.default.copyFile(pathToTemplateConfig, _path.default.resolve(dir, 'forge.config.js'));
                            }
                        }
                    },
                    {
                        title: 'Fixing .gitignore',
                        task: async ()=>{
                            if (await _fsExtra.default.pathExists(_path.default.resolve(dir, '.gitignore'))) {
                                const gitignore = await _fsExtra.default.readFile(_path.default.resolve(dir, '.gitignore'));
                                if (!gitignore.includes(calculatedOutDir)) {
                                    await _fsExtra.default.writeFile(_path.default.resolve(dir, '.gitignore'), `${gitignore}\n${calculatedOutDir}/`);
                                }
                            }
                        }
                    }, 
                ], listrOptions);
            }
        },
        {
            title: 'Finalizing import',
            options: {
                persistentOutput: true,
                bottomBar: Infinity
            },
            task: (_, task)=>{
                task.output = `We have attempted to convert your app to be in a format that Electron Forge understands.
          
          Thanks for using ${_chalk.default.green('Electron Forge')}!`;
            }
        }, 
    ], listrOptions);
    await runner.run();
};
exports.default = _default;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hcGkvaW1wb3J0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG5pbXBvcnQgeyBzYWZlWWFybk9yTnBtLCB1cGRhdGVFbGVjdHJvbkRlcGVuZGVuY3kgfSBmcm9tICdAZWxlY3Ryb24tZm9yZ2UvY29yZS11dGlscyc7XG5pbXBvcnQgYmFzZVRlbXBsYXRlIGZyb20gJ0BlbGVjdHJvbi1mb3JnZS90ZW1wbGF0ZS1iYXNlJztcbmltcG9ydCBjaGFsayBmcm9tICdjaGFsayc7XG5pbXBvcnQgZGVidWcgZnJvbSAnZGVidWcnO1xuaW1wb3J0IGZzIGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCB7IExpc3RyIH0gZnJvbSAnbGlzdHIyJztcbmltcG9ydCB7IG1lcmdlIH0gZnJvbSAnbG9kYXNoJztcblxuaW1wb3J0IGluc3RhbGxEZXBMaXN0LCB7IERlcFR5cGUsIERlcFZlcnNpb25SZXN0cmljdGlvbiB9IGZyb20gJy4uL3V0aWwvaW5zdGFsbC1kZXBlbmRlbmNpZXMnO1xuaW1wb3J0IHsgcmVhZFJhd1BhY2thZ2VKc29uIH0gZnJvbSAnLi4vdXRpbC9yZWFkLXBhY2thZ2UtanNvbic7XG5pbXBvcnQgdXBncmFkZUZvcmdlQ29uZmlnLCB7IHVwZGF0ZVVwZ3JhZGVkRm9yZ2VEZXZEZXBzIH0gZnJvbSAnLi4vdXRpbC91cGdyYWRlLWZvcmdlLWNvbmZpZyc7XG5cbmltcG9ydCB7IGluaXRHaXQgfSBmcm9tICcuL2luaXQtc2NyaXB0cy9pbml0LWdpdCc7XG5pbXBvcnQgeyBkZXBzLCBkZXZEZXBzLCBleGFjdERldkRlcHMgfSBmcm9tICcuL2luaXQtc2NyaXB0cy9pbml0LW5wbSc7XG5cbmNvbnN0IGQgPSBkZWJ1ZygnZWxlY3Ryb24tZm9yZ2U6aW1wb3J0Jyk7XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW1wb3J0T3B0aW9ucyB7XG4gIC8qKlxuICAgKiBUaGUgcGF0aCB0byB0aGUgYXBwIHRvIGJlIGltcG9ydGVkXG4gICAqL1xuICBkaXI/OiBzdHJpbmc7XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIHVzZSBzZW5zaWJsZSBkZWZhdWx0cyBvciBwcm9tcHQgdGhlIHVzZXIgdmlzdWFsbHlcbiAgICovXG4gIGludGVyYWN0aXZlPzogYm9vbGVhbjtcbiAgLyoqXG4gICAqIEFuIGFzeW5jIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0cnVlIG9yIGZhbHNlIGluIG9yZGVyIHRvIGNvbmZpcm0gdGhlIHN0YXJ0XG4gICAqIG9mIGltcG9ydGluZ1xuICAgKi9cbiAgY29uZmlybUltcG9ydD86ICgpID0+IFByb21pc2U8Ym9vbGVhbj47XG4gIC8qKlxuICAgKiBBbiBhc3luYyBmdW5jdGlvbiB0aGF0IHJldHVybnMgd2hldGhlciB0aGUgaW1wb3J0IHNob3VsZCBjb250aW51ZSBpZiBpdFxuICAgKiBsb29rcyBsaWtlIGEgZm9yZ2UgcHJvamVjdCBhbHJlYWR5XG4gICAqL1xuICBzaG91bGRDb250aW51ZU9uRXhpc3Rpbmc/OiAoKSA9PiBQcm9taXNlPGJvb2xlYW4+O1xuICAvKipcbiAgICogQW4gYXN5bmMgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHdoZXRoZXIgdGhlIGdpdmVuIGRlcGVuZGVuY3kgc2hvdWxkIGJlIHJlbW92ZWRcbiAgICovXG4gIHNob3VsZFJlbW92ZURlcGVuZGVuY3k/OiAoZGVwZW5kZW5jeTogc3RyaW5nLCBleHBsYW5hdGlvbjogc3RyaW5nKSA9PiBQcm9taXNlPGJvb2xlYW4+O1xuICAvKipcbiAgICogQW4gYXN5bmMgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHdoZXRoZXIgdGhlIGdpdmVuIHNjcmlwdCBzaG91bGQgYmUgb3ZlcnJpZGRlbiB3aXRoIGEgZm9yZ2Ugb25lXG4gICAqL1xuICBzaG91bGRVcGRhdGVTY3JpcHQ/OiAoc2NyaXB0TmFtZTogc3RyaW5nLCBuZXdWYWx1ZTogc3RyaW5nKSA9PiBQcm9taXNlPGJvb2xlYW4+O1xuICAvKipcbiAgICogVGhlIHBhdGggdG8gdGhlIGRpcmVjdG9yeSBjb250YWluaW5nIGdlbmVyYXRlZCBkaXN0cmlidXRhYmxlc1xuICAgKi9cbiAgb3V0RGlyPzogc3RyaW5nO1xufVxuXG5leHBvcnQgZGVmYXVsdCBhc3luYyAoe1xuICBkaXIgPSBwcm9jZXNzLmN3ZCgpLFxuICBpbnRlcmFjdGl2ZSA9IGZhbHNlLFxuICBjb25maXJtSW1wb3J0LFxuICBzaG91bGRDb250aW51ZU9uRXhpc3RpbmcsXG4gIHNob3VsZFJlbW92ZURlcGVuZGVuY3ksXG4gIHNob3VsZFVwZGF0ZVNjcmlwdCxcbiAgb3V0RGlyLFxufTogSW1wb3J0T3B0aW9ucyk6IFByb21pc2U8dm9pZD4gPT4ge1xuICBjb25zdCBsaXN0ck9wdGlvbnMgPSB7XG4gICAgY29uY3VycmVudDogZmFsc2UsXG4gICAgcmVuZGVyZXJPcHRpb25zOiB7XG4gICAgICBjb2xsYXBzZTogZmFsc2UsXG4gICAgICBjb2xsYXBzZUVycm9yczogZmFsc2UsXG4gICAgfSxcbiAgICByZW5kZXJlclNpbGVudDogIWludGVyYWN0aXZlLFxuICAgIHJlbmRlcmVyRmFsbGJhY2s6IEJvb2xlYW4ocHJvY2Vzcy5lbnYuREVCVUcgJiYgcHJvY2Vzcy5lbnYuREVCVUcuaW5jbHVkZXMoJ2VsZWN0cm9uLWZvcmdlJykpLFxuICB9O1xuXG4gIGNvbnN0IHJ1bm5lciA9IG5ldyBMaXN0cihcbiAgICBbXG4gICAgICB7XG4gICAgICAgIHRpdGxlOiAnTG9jYXRpbmcgaW1wb3J0YWJsZSBwcm9qZWN0JyxcbiAgICAgICAgdGFzazogYXN5bmMgKCkgPT4ge1xuICAgICAgICAgIGQoYEF0dGVtcHRpbmcgdG8gaW1wb3J0IHByb2plY3QgaW46ICR7ZGlyfWApO1xuICAgICAgICAgIGlmICghKGF3YWl0IGZzLnBhdGhFeGlzdHMoZGlyKSkgfHwgIShhd2FpdCBmcy5wYXRoRXhpc3RzKHBhdGgucmVzb2x2ZShkaXIsICdwYWNrYWdlLmpzb24nKSkpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFdlIGNvdWxkbid0IGZpbmQgYSBwcm9qZWN0IHdpdGggYSBwYWNrYWdlLmpzb24gZmlsZSBpbjogJHtkaXJ9YCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKHR5cGVvZiBjb25maXJtSW1wb3J0ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICBpZiAoIShhd2FpdCBjb25maXJtSW1wb3J0KCkpKSB7XG4gICAgICAgICAgICAgIC8vIFRPRE86IGZpZ3VyZSBvdXQgaWYgd2UgY2FuIGp1c3QgcmV0dXJuIGVhcmx5IGhlcmVcbiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXByb2Nlc3MtZXhpdFxuICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgYXdhaXQgaW5pdEdpdChkaXIpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdGl0bGU6ICdQcm9jZXNzaW5nIGNvbmZpZ3VyYXRpb24gYW5kIGRlcGVuZGVuY2llcycsXG4gICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICBwZXJzaXN0ZW50T3V0cHV0OiB0cnVlLFxuICAgICAgICAgIGJvdHRvbUJhcjogSW5maW5pdHksXG4gICAgICAgIH0sXG4gICAgICAgIHRhc2s6IGFzeW5jIChjdHgsIHRhc2spID0+IHtcbiAgICAgICAgICBjb25zdCBjYWxjdWxhdGVkT3V0RGlyID0gb3V0RGlyIHx8ICdvdXQnO1xuXG4gICAgICAgICAgY29uc3QgaW1wb3J0RGVwcyA9IChbXSBhcyBzdHJpbmdbXSkuY29uY2F0KGRlcHMpO1xuICAgICAgICAgIGxldCBpbXBvcnREZXZEZXBzID0gKFtdIGFzIHN0cmluZ1tdKS5jb25jYXQoZGV2RGVwcyk7XG4gICAgICAgICAgbGV0IGltcG9ydEV4YWN0RGV2RGVwcyA9IChbXSBhcyBzdHJpbmdbXSkuY29uY2F0KGV4YWN0RGV2RGVwcyk7XG5cbiAgICAgICAgICBsZXQgcGFja2FnZUpTT04gPSBhd2FpdCByZWFkUmF3UGFja2FnZUpzb24oZGlyKTtcbiAgICAgICAgICBpZiAoIXBhY2thZ2VKU09OLnZlcnNpb24pIHtcbiAgICAgICAgICAgIHRhc2sub3V0cHV0ID0gY2hhbGsueWVsbG93KGBQbGVhc2Ugc2V0IHRoZSAke2NoYWxrLmdyZWVuKCdcInZlcnNpb25cIicpfSBpbiB5b3VyIGFwcGxpY2F0aW9uJ3MgcGFja2FnZS5qc29uYCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChwYWNrYWdlSlNPTi5jb25maWcgJiYgcGFja2FnZUpTT04uY29uZmlnLmZvcmdlKSB7XG4gICAgICAgICAgICBpZiAocGFja2FnZUpTT04uY29uZmlnLmZvcmdlLm1ha2Vycykge1xuICAgICAgICAgICAgICB0YXNrLm91dHB1dCA9IGNoYWxrLmdyZWVuKCdFeGlzdGluZyBFbGVjdHJvbiBGb3JnZSBjb25maWd1cmF0aW9uIGRldGVjdGVkJyk7XG4gICAgICAgICAgICAgIGlmICh0eXBlb2Ygc2hvdWxkQ29udGludWVPbkV4aXN0aW5nID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEoYXdhaXQgc2hvdWxkQ29udGludWVPbkV4aXN0aW5nKCkpKSB7XG4gICAgICAgICAgICAgICAgICAvLyBUT0RPOiBmaWd1cmUgb3V0IGlmIHdlIGNhbiBqdXN0IHJldHVybiBlYXJseSBoZXJlXG4gICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcHJvY2Vzcy1leGl0XG4gICAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCEodHlwZW9mIHBhY2thZ2VKU09OLmNvbmZpZy5mb3JnZSA9PT0gJ29iamVjdCcpKSB7XG4gICAgICAgICAgICAgIHRhc2sub3V0cHV0ID0gY2hhbGsueWVsbG93KFxuICAgICAgICAgICAgICAgIFwiV2UgY2FuJ3QgdGVsbCBpZiB0aGUgRWxlY3Ryb24gRm9yZ2UgY29uZmlnIGlzIGNvbXBhdGlibGUgYmVjYXVzZSBpdCdzIGluIGFuIGV4dGVybmFsIEphdmFTY3JpcHQgZmlsZSwgbm90IHRyeWluZyB0byBjb252ZXJ0IGl0IGFuZCBjb250aW51aW5nIGFueXdheVwiXG4gICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBkKCdVcGdyYWRpbmcgYW4gRWxlY3Ryb24gRm9yZ2UgPCA2IHByb2plY3QnKTtcbiAgICAgICAgICAgICAgcGFja2FnZUpTT04uY29uZmlnLmZvcmdlID0gdXBncmFkZUZvcmdlQ29uZmlnKHBhY2thZ2VKU09OLmNvbmZpZy5mb3JnZSk7XG4gICAgICAgICAgICAgIGltcG9ydERldkRlcHMgPSB1cGRhdGVVcGdyYWRlZEZvcmdlRGV2RGVwcyhwYWNrYWdlSlNPTiwgaW1wb3J0RGV2RGVwcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcGFja2FnZUpTT04uZGVwZW5kZW5jaWVzID0gcGFja2FnZUpTT04uZGVwZW5kZW5jaWVzIHx8IHt9O1xuICAgICAgICAgIHBhY2thZ2VKU09OLmRldkRlcGVuZGVuY2llcyA9IHBhY2thZ2VKU09OLmRldkRlcGVuZGVuY2llcyB8fCB7fTtcblxuICAgICAgICAgIFtpbXBvcnREZXZEZXBzLCBpbXBvcnRFeGFjdERldkRlcHNdID0gdXBkYXRlRWxlY3Ryb25EZXBlbmRlbmN5KHBhY2thZ2VKU09OLCBpbXBvcnREZXZEZXBzLCBpbXBvcnRFeGFjdERldkRlcHMpO1xuXG4gICAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHBhY2thZ2VKU09OLmRlcGVuZGVuY2llcykuY29uY2F0KE9iamVjdC5rZXlzKHBhY2thZ2VKU09OLmRldkRlcGVuZGVuY2llcykpO1xuICAgICAgICAgIGNvbnN0IGJ1aWxkVG9vbFBhY2thZ2VzOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmcgfCB1bmRlZmluZWQ+ID0ge1xuICAgICAgICAgICAgJ0BlbGVjdHJvbi9nZXQnOiAnYWxyZWFkeSB1c2VzIHRoaXMgbW9kdWxlIGFzIGEgdHJhbnNpdGl2ZSBkZXBlbmRlbmN5JyxcbiAgICAgICAgICAgICdAZWxlY3Ryb24vb3N4LXNpZ24nOiAnYWxyZWFkeSB1c2VzIHRoaXMgbW9kdWxlIGFzIGEgdHJhbnNpdGl2ZSBkZXBlbmRlbmN5JyxcbiAgICAgICAgICAgICdlbGVjdHJvbi1idWlsZGVyJzogJ3Byb3ZpZGVzIG1vc3RseSBlcXVpdmFsZW50IGZ1bmN0aW9uYWxpdHknLFxuICAgICAgICAgICAgJ2VsZWN0cm9uLWRvd25sb2FkJzogJ2FscmVhZHkgdXNlcyB0aGlzIG1vZHVsZSBhcyBhIHRyYW5zaXRpdmUgZGVwZW5kZW5jeScsXG4gICAgICAgICAgICAnZWxlY3Ryb24tZm9yZ2UnOiAncmVwbGFjZWQgd2l0aCBAZWxlY3Ryb24tZm9yZ2UvY2xpJyxcbiAgICAgICAgICAgICdlbGVjdHJvbi1pbnN0YWxsZXItZGViaWFuJzogJ2FscmVhZHkgdXNlcyB0aGlzIG1vZHVsZSBhcyBhIHRyYW5zaXRpdmUgZGVwZW5kZW5jeScsXG4gICAgICAgICAgICAnZWxlY3Ryb24taW5zdGFsbGVyLWRtZyc6ICdhbHJlYWR5IHVzZXMgdGhpcyBtb2R1bGUgYXMgYSB0cmFuc2l0aXZlIGRlcGVuZGVuY3knLFxuICAgICAgICAgICAgJ2VsZWN0cm9uLWluc3RhbGxlci1mbGF0cGFrJzogJ2FscmVhZHkgdXNlcyB0aGlzIG1vZHVsZSBhcyBhIHRyYW5zaXRpdmUgZGVwZW5kZW5jeScsXG4gICAgICAgICAgICAnZWxlY3Ryb24taW5zdGFsbGVyLXJlZGhhdCc6ICdhbHJlYWR5IHVzZXMgdGhpcyBtb2R1bGUgYXMgYSB0cmFuc2l0aXZlIGRlcGVuZGVuY3knLFxuICAgICAgICAgICAgJ2VsZWN0cm9uLXBhY2thZ2VyJzogJ2FscmVhZHkgdXNlcyB0aGlzIG1vZHVsZSBhcyBhIHRyYW5zaXRpdmUgZGVwZW5kZW5jeScsXG4gICAgICAgICAgICAnZWxlY3Ryb24td2luc3RhbGxlcic6ICdhbHJlYWR5IHVzZXMgdGhpcyBtb2R1bGUgYXMgYSB0cmFuc2l0aXZlIGRlcGVuZGVuY3knLFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBmb3IgKGNvbnN0IGtleSBvZiBrZXlzKSB7XG4gICAgICAgICAgICBpZiAoYnVpbGRUb29sUGFja2FnZXNba2V5XSkge1xuICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvblxuICAgICAgICAgICAgICBjb25zdCBleHBsYW5hdGlvbiA9IGJ1aWxkVG9vbFBhY2thZ2VzW2tleV0hO1xuICAgICAgICAgICAgICBsZXQgcmVtb3ZlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzaG91bGRSZW1vdmVEZXBlbmRlbmN5ID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgcmVtb3ZlID0gYXdhaXQgc2hvdWxkUmVtb3ZlRGVwZW5kZW5jeShrZXksIGV4cGxhbmF0aW9uKTtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmIChyZW1vdmUpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgcGFja2FnZUpTT04uZGVwZW5kZW5jaWVzW2tleV07XG4gICAgICAgICAgICAgICAgZGVsZXRlIHBhY2thZ2VKU09OLmRldkRlcGVuZGVuY2llc1trZXldO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcGFja2FnZUpTT04uc2NyaXB0cyA9IHBhY2thZ2VKU09OLnNjcmlwdHMgfHwge307XG4gICAgICAgICAgZCgncmVhZGluZyBjdXJyZW50IHNjcmlwdHMgb2JqZWN0OicsIHBhY2thZ2VKU09OLnNjcmlwdHMpO1xuXG4gICAgICAgICAgY29uc3QgdXBkYXRlUGFja2FnZVNjcmlwdCA9IGFzeW5jIChzY3JpcHROYW1lOiBzdHJpbmcsIG5ld1ZhbHVlOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIGlmIChwYWNrYWdlSlNPTi5zY3JpcHRzW3NjcmlwdE5hbWVdICE9PSBuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICBsZXQgdXBkYXRlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgaWYgKHR5cGVvZiBzaG91bGRVcGRhdGVTY3JpcHQgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGUgPSBhd2FpdCBzaG91bGRVcGRhdGVTY3JpcHQoc2NyaXB0TmFtZSwgbmV3VmFsdWUpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIGlmICh1cGRhdGUpIHtcbiAgICAgICAgICAgICAgICBwYWNrYWdlSlNPTi5zY3JpcHRzW3NjcmlwdE5hbWVdID0gbmV3VmFsdWU7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgYXdhaXQgdXBkYXRlUGFja2FnZVNjcmlwdCgnc3RhcnQnLCAnZWxlY3Ryb24tZm9yZ2Ugc3RhcnQnKTtcbiAgICAgICAgICBhd2FpdCB1cGRhdGVQYWNrYWdlU2NyaXB0KCdwYWNrYWdlJywgJ2VsZWN0cm9uLWZvcmdlIHBhY2thZ2UnKTtcbiAgICAgICAgICBhd2FpdCB1cGRhdGVQYWNrYWdlU2NyaXB0KCdtYWtlJywgJ2VsZWN0cm9uLWZvcmdlIG1ha2UnKTtcblxuICAgICAgICAgIGQoJ2ZvcmdpZmllZCBzY3JpcHRzIG9iamVjdDonLCBwYWNrYWdlSlNPTi5zY3JpcHRzKTtcblxuICAgICAgICAgIGNvbnN0IHdyaXRlQ2hhbmdlcyA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IGZzLndyaXRlSnNvbihwYXRoLnJlc29sdmUoZGlyLCAncGFja2FnZS5qc29uJyksIHBhY2thZ2VKU09OLCB7IHNwYWNlczogMiB9KTtcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgcmV0dXJuIHRhc2submV3TGlzdHIoXG4gICAgICAgICAgICBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0luc3RhbGxpbmcgZGVwZW5kZW5jaWVzJyxcbiAgICAgICAgICAgICAgICB0YXNrOiBhc3luYyAoXywgdGFzaykgPT4ge1xuICAgICAgICAgICAgICAgICAgY29uc3QgcGFja2FnZU1hbmFnZXIgPSBzYWZlWWFybk9yTnBtKCk7XG4gICAgICAgICAgICAgICAgICBhd2FpdCB3cml0ZUNoYW5nZXMoKTtcblxuICAgICAgICAgICAgICAgICAgZCgnZGVsZXRpbmcgb2xkIGRlcGVuZGVuY2llcyBmb3JjZWZ1bGx5Jyk7XG4gICAgICAgICAgICAgICAgICBhd2FpdCBmcy5yZW1vdmUocGF0aC5yZXNvbHZlKGRpciwgJ25vZGVfbW9kdWxlcy8uYmluL2VsZWN0cm9uJykpO1xuICAgICAgICAgICAgICAgICAgYXdhaXQgZnMucmVtb3ZlKHBhdGgucmVzb2x2ZShkaXIsICdub2RlX21vZHVsZXMvLmJpbi9lbGVjdHJvbi5jbWQnKSk7XG5cbiAgICAgICAgICAgICAgICAgIGQoJ2luc3RhbGxpbmcgZGVwZW5kZW5jaWVzJyk7XG4gICAgICAgICAgICAgICAgICB0YXNrLm91dHB1dCA9IGAke3BhY2thZ2VNYW5hZ2VyfSBpbnN0YWxsICR7aW1wb3J0RGVwcy5qb2luKCcgJyl9YDtcbiAgICAgICAgICAgICAgICAgIGF3YWl0IGluc3RhbGxEZXBMaXN0KGRpciwgaW1wb3J0RGVwcyk7XG5cbiAgICAgICAgICAgICAgICAgIGQoJ2luc3RhbGxpbmcgZGV2RGVwZW5kZW5jaWVzJyk7XG4gICAgICAgICAgICAgICAgICB0YXNrLm91dHB1dCA9IGAke3BhY2thZ2VNYW5hZ2VyfSBpbnN0YWxsIC0tZGV2ICR7aW1wb3J0RGV2RGVwcy5qb2luKCcgJyl9YDtcbiAgICAgICAgICAgICAgICAgIGF3YWl0IGluc3RhbGxEZXBMaXN0KGRpciwgaW1wb3J0RGV2RGVwcywgRGVwVHlwZS5ERVYpO1xuXG4gICAgICAgICAgICAgICAgICBkKCdpbnN0YWxsaW5nIGV4YWN0RGV2RGVwZW5kZW5jaWVzJyk7XG4gICAgICAgICAgICAgICAgICB0YXNrLm91dHB1dCA9IGAke3BhY2thZ2VNYW5hZ2VyfSBpbnN0YWxsIC0tZGV2IC0tZXhhY3QgJHtpbXBvcnRFeGFjdERldkRlcHMuam9pbignICcpfWA7XG4gICAgICAgICAgICAgICAgICBhd2FpdCBpbnN0YWxsRGVwTGlzdChkaXIsIGltcG9ydEV4YWN0RGV2RGVwcywgRGVwVHlwZS5ERVYsIERlcFZlcnNpb25SZXN0cmljdGlvbi5FWEFDVCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIHRpdGxlOiAnQ29weWluZyBiYXNlIHRlbXBsYXRlIEZvcmdlIGNvbmZpZ3VyYXRpb24nLFxuICAgICAgICAgICAgICAgIHRhc2s6IGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHBhdGhUb1RlbXBsYXRlQ29uZmlnID0gcGF0aC5yZXNvbHZlKGJhc2VUZW1wbGF0ZS50ZW1wbGF0ZURpciwgJ2ZvcmdlLmNvbmZpZy5qcycpO1xuXG4gICAgICAgICAgICAgICAgICAvLyBpZiB0aGVyZSdzIGFuIGV4aXN0aW5nIGNvbmZpZy5mb3JnZSBvYmplY3QgaW4gcGFja2FnZS5qc29uXG4gICAgICAgICAgICAgICAgICBpZiAocGFja2FnZUpTT04/LmNvbmZpZz8uZm9yZ2UgJiYgdHlwZW9mIHBhY2thZ2VKU09OLmNvbmZpZy5mb3JnZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgZCgnZGV0ZWN0ZWQgZXhpc3RpbmcgRm9yZ2UgY29uZmlnIGluIHBhY2thZ2UuanNvbiwgbWVyZ2luZyB3aXRoIGJhc2UgdGVtcGxhdGUgRm9yZ2UgY29uZmlnJyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdmFyLXJlcXVpcmVzXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRlbXBsYXRlQ29uZmlnID0gcmVxdWlyZShwYXRoLnJlc29sdmUoYmFzZVRlbXBsYXRlLnRlbXBsYXRlRGlyLCAnZm9yZ2UuY29uZmlnLmpzJykpO1xuICAgICAgICAgICAgICAgICAgICBwYWNrYWdlSlNPTiA9IGF3YWl0IHJlYWRSYXdQYWNrYWdlSnNvbihkaXIpO1xuICAgICAgICAgICAgICAgICAgICBtZXJnZSh0ZW1wbGF0ZUNvbmZpZywgcGFja2FnZUpTT04uY29uZmlnLmZvcmdlKTsgLy8gbXV0YXRlcyB0aGUgdGVtcGxhdGVDb25maWcgb2JqZWN0XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHdyaXRlQ2hhbmdlcygpO1xuICAgICAgICAgICAgICAgICAgICAvLyBvdGhlcndpc2UsIHdyaXRlIHRvIGZvcmdlLmNvbmZpZy5qc1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZCgnd3JpdGluZyBuZXcgZm9yZ2UuY29uZmlnLmpzJyk7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGZzLmNvcHlGaWxlKHBhdGhUb1RlbXBsYXRlQ29uZmlnLCBwYXRoLnJlc29sdmUoZGlyLCAnZm9yZ2UuY29uZmlnLmpzJykpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0aXRsZTogJ0ZpeGluZyAuZ2l0aWdub3JlJyxcbiAgICAgICAgICAgICAgICB0YXNrOiBhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICBpZiAoYXdhaXQgZnMucGF0aEV4aXN0cyhwYXRoLnJlc29sdmUoZGlyLCAnLmdpdGlnbm9yZScpKSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBnaXRpZ25vcmUgPSBhd2FpdCBmcy5yZWFkRmlsZShwYXRoLnJlc29sdmUoZGlyLCAnLmdpdGlnbm9yZScpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFnaXRpZ25vcmUuaW5jbHVkZXMoY2FsY3VsYXRlZE91dERpcikpIHtcbiAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBmcy53cml0ZUZpbGUocGF0aC5yZXNvbHZlKGRpciwgJy5naXRpZ25vcmUnKSwgYCR7Z2l0aWdub3JlfVxcbiR7Y2FsY3VsYXRlZE91dERpcn0vYCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXSxcbiAgICAgICAgICAgIGxpc3RyT3B0aW9uc1xuICAgICAgICAgICk7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICB0aXRsZTogJ0ZpbmFsaXppbmcgaW1wb3J0JyxcbiAgICAgICAgb3B0aW9uczoge1xuICAgICAgICAgIHBlcnNpc3RlbnRPdXRwdXQ6IHRydWUsXG4gICAgICAgICAgYm90dG9tQmFyOiBJbmZpbml0eSxcbiAgICAgICAgfSxcbiAgICAgICAgdGFzazogKF8sIHRhc2spID0+IHtcbiAgICAgICAgICB0YXNrLm91dHB1dCA9IGBXZSBoYXZlIGF0dGVtcHRlZCB0byBjb252ZXJ0IHlvdXIgYXBwIHRvIGJlIGluIGEgZm9ybWF0IHRoYXQgRWxlY3Ryb24gRm9yZ2UgdW5kZXJzdGFuZHMuXG4gICAgICAgICAgXG4gICAgICAgICAgVGhhbmtzIGZvciB1c2luZyAke2NoYWxrLmdyZWVuKCdFbGVjdHJvbiBGb3JnZScpfSFgO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICBdLFxuICAgIGxpc3RyT3B0aW9uc1xuICApO1xuXG4gIGF3YWl0IHJ1bm5lci5ydW4oKTtcbn07XG4iXSwibmFtZXMiOlsiZCIsImRlYnVnIiwiZGlyIiwicHJvY2VzcyIsImN3ZCIsImludGVyYWN0aXZlIiwiY29uZmlybUltcG9ydCIsInNob3VsZENvbnRpbnVlT25FeGlzdGluZyIsInNob3VsZFJlbW92ZURlcGVuZGVuY3kiLCJzaG91bGRVcGRhdGVTY3JpcHQiLCJvdXREaXIiLCJsaXN0ck9wdGlvbnMiLCJjb25jdXJyZW50IiwicmVuZGVyZXJPcHRpb25zIiwiY29sbGFwc2UiLCJjb2xsYXBzZUVycm9ycyIsInJlbmRlcmVyU2lsZW50IiwicmVuZGVyZXJGYWxsYmFjayIsIkJvb2xlYW4iLCJlbnYiLCJERUJVRyIsImluY2x1ZGVzIiwicnVubmVyIiwiTGlzdHIiLCJ0aXRsZSIsInRhc2siLCJmcyIsInBhdGhFeGlzdHMiLCJwYXRoIiwicmVzb2x2ZSIsIkVycm9yIiwiZXhpdCIsImluaXRHaXQiLCJvcHRpb25zIiwicGVyc2lzdGVudE91dHB1dCIsImJvdHRvbUJhciIsIkluZmluaXR5IiwiY3R4IiwiY2FsY3VsYXRlZE91dERpciIsImltcG9ydERlcHMiLCJjb25jYXQiLCJkZXBzIiwiaW1wb3J0RGV2RGVwcyIsImRldkRlcHMiLCJpbXBvcnRFeGFjdERldkRlcHMiLCJleGFjdERldkRlcHMiLCJwYWNrYWdlSlNPTiIsInJlYWRSYXdQYWNrYWdlSnNvbiIsInZlcnNpb24iLCJvdXRwdXQiLCJjaGFsayIsInllbGxvdyIsImdyZWVuIiwiY29uZmlnIiwiZm9yZ2UiLCJtYWtlcnMiLCJ1cGdyYWRlRm9yZ2VDb25maWciLCJ1cGRhdGVVcGdyYWRlZEZvcmdlRGV2RGVwcyIsImRlcGVuZGVuY2llcyIsImRldkRlcGVuZGVuY2llcyIsInVwZGF0ZUVsZWN0cm9uRGVwZW5kZW5jeSIsImtleXMiLCJPYmplY3QiLCJidWlsZFRvb2xQYWNrYWdlcyIsImtleSIsImV4cGxhbmF0aW9uIiwicmVtb3ZlIiwic2NyaXB0cyIsInVwZGF0ZVBhY2thZ2VTY3JpcHQiLCJzY3JpcHROYW1lIiwibmV3VmFsdWUiLCJ1cGRhdGUiLCJ3cml0ZUNoYW5nZXMiLCJ3cml0ZUpzb24iLCJzcGFjZXMiLCJuZXdMaXN0ciIsIl8iLCJwYWNrYWdlTWFuYWdlciIsInNhZmVZYXJuT3JOcG0iLCJqb2luIiwiaW5zdGFsbERlcExpc3QiLCJEZXBUeXBlIiwiREVWIiwiRGVwVmVyc2lvblJlc3RyaWN0aW9uIiwiRVhBQ1QiLCJwYXRoVG9UZW1wbGF0ZUNvbmZpZyIsImJhc2VUZW1wbGF0ZSIsInRlbXBsYXRlRGlyIiwidGVtcGxhdGVDb25maWciLCJyZXF1aXJlIiwibWVyZ2UiLCJjb3B5RmlsZSIsImdpdGlnbm9yZSIsInJlYWRGaWxlIiwid3JpdGVGaWxlIiwicnVuIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFpQixHQUFNLENBQU4sS0FBTTtBQUVpQyxHQUE0QixDQUE1QixVQUE0QjtBQUMzRCxHQUErQixDQUEvQixhQUErQjtBQUN0QyxHQUFPLENBQVAsTUFBTztBQUNQLEdBQU8sQ0FBUCxNQUFPO0FBQ1YsR0FBVSxDQUFWLFFBQVU7QUFDSCxHQUFRLENBQVIsT0FBUTtBQUNSLEdBQVEsQ0FBUixPQUFRO0FBRWlDLEdBQThCLENBQTlCLG9CQUE4QjtBQUMxRCxHQUEyQixDQUEzQixnQkFBMkI7QUFDQyxHQUE4QixDQUE5QixtQkFBOEI7QUFFckUsR0FBeUIsQ0FBekIsUUFBeUI7QUFDTCxHQUF5QixDQUF6QixRQUF5Qjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRXJFLEtBQUssQ0FBQ0EsQ0FBQyxPQUFHQyxNQUFLLFVBQUMsQ0FBdUI7c0JBbUNqQixDQUFDLENBQ3JCQyxHQUFHLEVBQUdDLE9BQU8sQ0FBQ0MsR0FBRyxLQUNqQkMsV0FBVyxFQUFHLEtBQUssR0FDbkJDLGFBQWEsR0FDYkMsd0JBQXdCLEdBQ3hCQyxzQkFBc0IsR0FDdEJDLGtCQUFrQixHQUNsQkMsTUFBTSxFQUNPLENBQUMsR0FBb0IsQ0FBQztJQUNuQyxLQUFLLENBQUNDLFlBQVksR0FBRyxDQUFDO1FBQ3BCQyxVQUFVLEVBQUUsS0FBSztRQUNqQkMsZUFBZSxFQUFFLENBQUM7WUFDaEJDLFFBQVEsRUFBRSxLQUFLO1lBQ2ZDLGNBQWMsRUFBRSxLQUFLO1FBQ3ZCLENBQUM7UUFDREMsY0FBYyxHQUFHWCxXQUFXO1FBQzVCWSxnQkFBZ0IsRUFB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
"use strict";
var _path = _interopRequireDefault(require("path"));
var _core = require("@electron-forge/core");
var _commander = _interopRequireDefault(require("commander"));
var _fsExtra = _interopRequireDefault(require("fs-extra"));
require("./util/terminate");
var _workingDir = _interopRequireDefault(require("./util/working-dir"));
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
(async ()=>{
    let commandArgs = process.argv;
    let appArgs;
    const doubleDashIndex = process.argv.indexOf('--');
    if (doubleDashIndex !== -1) {
        commandArgs = process.argv.slice(0, doubleDashIndex);
        appArgs = process.argv.slice(doubleDashIndex + 1);
    }
    let dir = process.cwd();
    _commander.default.version((await _fsExtra.default.readJson(_path.default.resolve(__dirname, '../package.json'))).version).arguments('[cwd]').option('-p, --app-path <path>', "Override the path to the Electron app to launch (defaults to '.')").option('-l, --enable-logging', 'Enable advanced logging.  This will log internal Electron things').option('-n, --run-as-node', 'Run the Electron app as a Node.JS script').option('--vscode', 'Used to enable arg transformation for debugging Electron through VSCode.  Do not use yourself.').option('-i, --inspect-electron', 'Triggers inspect mode on Electron to allow debugging the main process.  Electron >1.7 only').option('--inspect-brk-electron', 'Triggers inspect-brk mode on Electron to allow debugging the main process.  Electron >1.7 only').action((cwd)=>{
        dir = (0, _workingDir).default(dir, cwd);
    }).parse(commandArgs);
    _commander.default.on('--help', ()=>{
        console.log('  Any arguments found after "--" will be passed to the Electron app, e.g.');
        console.log('');
        console.log('    $ electron-forge /path/to/project -l -- -d -f foo.txt');
        console.log('');
        console.log('  will pass the arguments "-d -f foo.txt" to the Electron app');
    });
    const opts = {
        dir,
        interactive: true,
        enableLogging: !!_commander.default.enableLogging,
        runAsNode: !!_commander.default.runAsNode,
        inspect: !!_commander.default.inspectElectron,
        inspectBrk: !!_commander.default.inspectBrkElectron
    };
    if (_commander.default.vscode && appArgs) {
        // Args are in the format ~arg~ so we need to strip the "~"
        appArgs = appArgs.map((arg)=>arg.substr(1, arg.length - 2)
        ).filter((arg)=>arg.length > 0
        );
    }
    if (_commander.default.appPath) opts.appPath = _commander.default.appPath;
    if (appArgs) opts.args = appArgs;
    const spawned = await _core.api.start(opts);
    await new Promise((resolve)=>{
        const listenForExit = (child)=>{
            // Why: changing to const causes TypeScript compilation to fail.
            /* eslint-disable prefer-const */ let onExit;
            let onRestart;
            /* eslint-enable prefer-const */ const removeListeners = ()=>{
                child.removeListener('exit', onExit);
                child.removeListener('restarted', onRestart);
            };
            onExit = (code)=>{
                removeListeners();
                if (spawned.restarted) return;
                if (code !== 0) {
                    process.exit(code);
                }
                resolve();
            };
            onRestart = (newChild)=>{
                removeListeners();
                listenForExit(newChild);
            };
            child.on('exit', onExit);
            child.on('restarted', onRestart);
        };
        listenForExit(spawned);
    });
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGVjdHJvbi1mb3JnZS1zdGFydC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuaW1wb3J0IHsgYXBpLCBTdGFydE9wdGlvbnMgfSBmcm9tICdAZWxlY3Ryb24tZm9yZ2UvY29yZSc7XG5pbXBvcnQgeyBFbGVjdHJvblByb2Nlc3MgfSBmcm9tICdAZWxlY3Ryb24tZm9yZ2Uvc2hhcmVkLXR5cGVzJztcbmltcG9ydCBwcm9ncmFtIGZyb20gJ2NvbW1hbmRlcic7XG5pbXBvcnQgZnMgZnJvbSAnZnMtZXh0cmEnO1xuXG5pbXBvcnQgJy4vdXRpbC90ZXJtaW5hdGUnO1xuaW1wb3J0IHdvcmtpbmdEaXIgZnJvbSAnLi91dGlsL3dvcmtpbmctZGlyJztcblxuKGFzeW5jICgpID0+IHtcbiAgbGV0IGNvbW1hbmRBcmdzID0gcHJvY2Vzcy5hcmd2O1xuICBsZXQgYXBwQXJncztcblxuICBjb25zdCBkb3VibGVEYXNoSW5kZXggPSBwcm9jZXNzLmFyZ3YuaW5kZXhPZignLS0nKTtcbiAgaWYgKGRvdWJsZURhc2hJbmRleCAhPT0gLTEpIHtcbiAgICBjb21tYW5kQXJncyA9IHByb2Nlc3MuYXJndi5zbGljZSgwLCBkb3VibGVEYXNoSW5kZXgpO1xuICAgIGFwcEFyZ3MgPSBwcm9jZXNzLmFyZ3Yuc2xpY2UoZG91YmxlRGFzaEluZGV4ICsgMSk7XG4gIH1cblxuICBsZXQgZGlyID0gcHJvY2Vzcy5jd2QoKTtcbiAgcHJvZ3JhbVxuICAgIC52ZXJzaW9uKChhd2FpdCBmcy5yZWFkSnNvbihwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4vcGFja2FnZS5qc29uJykpKS52ZXJzaW9uKVxuICAgIC5hcmd1bWVudHMoJ1tjd2RdJylcbiAgICAub3B0aW9uKCctcCwgLS1hcHAtcGF0aCA8cGF0aD4nLCBcIk92ZXJyaWRlIHRoZSBwYXRoIHRvIHRoZSBFbGVjdHJvbiBhcHAgdG8gbGF1bmNoIChkZWZhdWx0cyB0byAnLicpXCIpXG4gICAgLm9wdGlvbignLWwsIC0tZW5hYmxlLWxvZ2dpbmcnLCAnRW5hYmxlIGFkdmFuY2VkIGxvZ2dpbmcuICBUaGlzIHdpbGwgbG9nIGludGVybmFsIEVsZWN0cm9uIHRoaW5ncycpXG4gICAgLm9wdGlvbignLW4sIC0tcnVuLWFzLW5vZGUnLCAnUnVuIHRoZSBFbGVjdHJvbiBhcHAgYXMgYSBOb2RlLkpTIHNjcmlwdCcpXG4gICAgLm9wdGlvbignLS12c2NvZGUnLCAnVXNlZCB0byBlbmFibGUgYXJnIHRyYW5zZm9ybWF0aW9uIGZvciBkZWJ1Z2dpbmcgRWxlY3Ryb24gdGhyb3VnaCBWU0NvZGUuICBEbyBub3QgdXNlIHlvdXJzZWxmLicpXG4gICAgLm9wdGlvbignLWksIC0taW5zcGVjdC1lbGVjdHJvbicsICdUcmlnZ2VycyBpbnNwZWN0IG1vZGUgb24gRWxlY3Ryb24gdG8gYWxsb3cgZGVidWdnaW5nIHRoZSBtYWluIHByb2Nlc3MuICBFbGVjdHJvbiA+MS43IG9ubHknKVxuICAgIC5vcHRpb24oJy0taW5zcGVjdC1icmstZWxlY3Ryb24nLCAnVHJpZ2dlcnMgaW5zcGVjdC1icmsgbW9kZSBvbiBFbGVjdHJvbiB0byBhbGxvdyBkZWJ1Z2dpbmcgdGhlIG1haW4gcHJvY2Vzcy4gIEVsZWN0cm9uID4xLjcgb25seScpXG4gICAgLmFjdGlvbigoY3dkKSA9PiB7XG4gICAgICBkaXIgPSB3b3JraW5nRGlyKGRpciwgY3dkKTtcbiAgICB9KVxuICAgIC5wYXJzZShjb21tYW5kQXJncyk7XG5cbiAgcHJvZ3JhbS5vbignLS1oZWxwJywgKCkgPT4ge1xuICAgIGNvbnNvbGUubG9nKCcgIEFueSBhcmd1bWVudHMgZm91bmQgYWZ0ZXIgXCItLVwiIHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBFbGVjdHJvbiBhcHAsIGUuZy4nKTtcbiAgICBjb25zb2xlLmxvZygnJyk7XG4gICAgY29uc29sZS5sb2coJyAgICAkIGVsZWN0cm9uLWZvcmdlIC9wYXRoL3RvL3Byb2plY3QgLWwgLS0gLWQgLWYgZm9vLnR4dCcpO1xuICAgIGNvbnNvbGUubG9nKCcnKTtcbiAgICBjb25zb2xlLmxvZygnICB3aWxsIHBhc3MgdGhlIGFyZ3VtZW50cyBcIi1kIC1mIGZvby50eHRcIiB0byB0aGUgRWxlY3Ryb24gYXBwJyk7XG4gIH0pO1xuXG4gIGNvbnN0IG9wdHM6IFN0YXJ0T3B0aW9ucyA9IHtcbiAgICBkaXIsXG4gICAgaW50ZXJhY3RpdmU6IHRydWUsXG4gICAgZW5hYmxlTG9nZ2luZzogISFwcm9ncmFtLmVuYWJsZUxvZ2dpbmcsXG4gICAgcnVuQXNOb2RlOiAhIXByb2dyYW0ucnVuQXNOb2RlLFxuICAgIGluc3BlY3Q6ICEhcHJvZ3JhbS5pbnNwZWN0RWxlY3Ryb24sXG4gICAgaW5zcGVjdEJyazogISFwcm9ncmFtLmluc3BlY3RCcmtFbGVjdHJvbixcbiAgfTtcblxuICBpZiAocHJvZ3JhbS52c2NvZGUgJiYgYXBwQXJncykge1xuICAgIC8vIEFyZ3MgYXJlIGluIHRoZSBmb3JtYXQgfmFyZ34gc28gd2UgbmVlZCB0byBzdHJpcCB0aGUgXCJ+XCJcbiAgICBhcHBBcmdzID0gYXBwQXJncy5tYXAoKGFyZykgPT4gYXJnLnN1YnN0cigxLCBhcmcubGVuZ3RoIC0gMikpLmZpbHRlcigoYXJnKSA9PiBhcmcubGVuZ3RoID4gMCk7XG4gIH1cblxuICBpZiAocHJvZ3JhbS5hcHBQYXRoKSBvcHRzLmFwcFBhdGggPSBwcm9ncmFtLmFwcFBhdGg7XG4gIGlmIChhcHBBcmdzKSBvcHRzLmFyZ3MgPSBhcHBBcmdzO1xuXG4gIGNvbnN0IHNwYXduZWQgPSBhd2FpdCBhcGkuc3RhcnQob3B0cyk7XG5cbiAgYXdhaXQgbmV3IFByb21pc2U8dm9pZD4oKHJlc29sdmUpID0+IHtcbiAgICBjb25zdCBsaXN0ZW5Gb3JFeGl0ID0gKGNoaWxkOiBFbGVjdHJvblByb2Nlc3MpID0+IHtcbiAgICAgIC8vIFdoeTogY2hhbmdpbmcgdG8gY29uc3QgY2F1c2VzIFR5cGVTY3JpcHQgY29tcGlsYXRpb24gdG8gZmFpbC5cbiAgICAgIC8qIGVzbGludC1kaXNhYmxlIHByZWZlci1jb25zdCAqL1xuICAgICAgbGV0IG9uRXhpdDogTm9kZUpTLkV4aXRMaXN0ZW5lcjtcbiAgICAgIGxldCBvblJlc3RhcnQ6IChuZXdDaGlsZDogRWxlY3Ryb25Qcm9jZXNzKSA9PiB2b2lkO1xuICAgICAgLyogZXNsaW50LWVuYWJsZSBwcmVmZXItY29uc3QgKi9cbiAgICAgIGNvbnN0IHJlbW92ZUxpc3RlbmVycyA9ICgpID0+IHtcbiAgICAgICAgY2hpbGQucmVtb3ZlTGlzdGVuZXIoJ2V4aXQnLCBvbkV4aXQpO1xuICAgICAgICBjaGlsZC5yZW1vdmVMaXN0ZW5lcigncmVzdGFydGVkJywgb25SZXN0YXJ0KTtcbiAgICAgIH07XG4gICAgICBvbkV4aXQgPSAoY29kZTogbnVtYmVyKSA9PiB7XG4gICAgICAgIHJlbW92ZUxpc3RlbmVycygpO1xuICAgICAgICBpZiAoc3Bhd25lZC5yZXN0YXJ0ZWQpIHJldHVybjtcbiAgICAgICAgaWYgKGNvZGUgIT09IDApIHtcbiAgICAgICAgICBwcm9jZXNzLmV4aXQoY29kZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgfTtcbiAgICAgIG9uUmVzdGFydCA9IChuZXdDaGlsZDogRWxlY3Ryb25Qcm9jZXNzKSA9PiB7XG4gICAgICAgIHJlbW92ZUxpc3RlbmVycygpO1xuICAgICAgICBsaXN0ZW5Gb3JFeGl0KG5ld0NoaWxkKTtcbiAgICAgIH07XG4gICAgICBjaGlsZC5vbignZXhpdCcsIG9uRXhpdCk7XG4gICAgICBjaGlsZC5vbigncmVzdGFydGVkJywgb25SZXN0YXJ0KTtcbiAgICB9O1xuICAgIGxpc3RlbkZvckV4aXQoc3Bhd25lZCBhcyBFbGVjdHJvblByb2Nlc3MpO1xuICB9KTtcbn0pKCk7XG4iXSwibmFtZXMiOlsiY29tbWFuZEFyZ3MiLCJwcm9jZXNzIiwiYXJndiIsImFwcEFyZ3MiLCJkb3VibGVEYXNoSW5kZXgiLCJpbmRleE9mIiwic2xpY2UiLCJkaXIiLCJjd2QiLCJwcm9ncmFtIiwidmVyc2lvbiIsImZzIiwicmVhZEpzb24iLCJwYXRoIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsImFyZ3VtZW50cyIsIm9wdGlvbiIsImFjdGlvbiIsIndvcmtpbmdEaXIiLCJwYXJzZSIsIm9uIiwiY29uc29sZSIsImxvZyIsIm9wdHMiLCJpbnRlcmFjdGl2ZSIsImVuYWJsZUxvZ2dpbmciLCJydW5Bc05vZGUiLCJpbnNwZWN0IiwiaW5zcGVjdEVsZWN0cm9uIiwiaW5zcGVjdEJyayIsImluc3BlY3RCcmtFbGVjdHJvbiIsInZzY29kZSIsIm1hcCIsImFyZyIsInN1YnN0ciIsImxlbmd0aCIsImZpbHRlciIsImFwcFBhdGgiLCJhcmdzIiwic3Bhd25lZCIsImFwaSIsInN0YXJ0IiwiUHJvbWlzZSIsImxpc3RlbkZvckV4aXQiLCJjaGlsZCIsIm9uRXhpdCIsIm9uUmVzdGFydCIsInJlbW92ZUxpc3RlbmVycyIsInJlbW92ZUxpc3RlbmVyIiwiY29kZSIsInJlc3RhcnRlZCIsImV4aXQiLCJuZXdDaGlsZCJdLCJtYXBwaW5ncyI6IjtBQUFpQixHQUFNLENBQU4sS0FBTTtBQUVXLEdBQXNCLENBQXRCLEtBQXNCO0FBRXBDLEdBQVcsQ0FBWCxVQUFXO0FBQ2hCLEdBQVUsQ0FBVixRQUFVOztBQUdGLEdBQW9CLENBQXBCLFdBQW9COzs7Ozs7V0FFOUIsQ0FBQztJQUNaLEdBQUcsQ0FBQ0EsV0FBVyxHQUFHQyxPQUFPLENBQUNDLElBQUk7SUFDOUIsR0FBRyxDQUFDQyxPQUFPO0lBRVgsS0FBSyxDQUFDQyxlQUFlLEdBQUdILE9BQU8sQ0FBQ0MsSUFBSSxDQUFDRyxPQUFPLENBQUMsQ0FBSTtJQUNqRCxFQUFFLEVBQUVELGVBQWUsTUFBTSxDQUFDLEVBQUUsQ0FBQztRQUMzQkosV0FBVyxHQUFHQyxPQUFPLENBQUNDLElBQUksQ0FBQ0ksS0FBSyxDQUFDLENBQUMsRUFBRUYsZUFBZTtRQUNuREQsT0FBTyxHQUFHRixPQUFPLENBQUNDLElBQUksQ0FBQ0ksS0FBSyxDQUFDRixlQUFlLEdBQUcsQ0FBQztJ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